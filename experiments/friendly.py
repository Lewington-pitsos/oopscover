import logging
import time
import json
import openai

with open('creds.json') as f:
    openai.api_key = json.load(f)['api_key']

logging.basicConfig(level=logging.INFO, format='%(asctime)s %(levelname)s %(message)s')


with open('cruft/answers2.json') as f:
    answers = json.load(f)

first = answers[0]
prompt = first['answers'][0]['meta']['prompt']
answer = first['answers'][0]['answer']

base_prompt = "===\nContext: * Who are the other doctors treating me during the admission (e.g. anaesthetist, assistant surgeon) and how can I get an estimate of their fees?\n\n* Will the doctor provide me with a written estimate of any costs I\u00e2\u0080\u0099ll have to pay so I can consider this when agreeing to the treatment?\n\n* How will the doctor bill me?\n\n* Which hospital will be admitted to and does this hospital have an agreement with my insurer?\n\n* When will I have to pay?\n\nIf you can\u00e2\u0080\u0099t afford the treatment, discuss alternative treatment options\nwith your specialist or GP. You may also consider shopping around to see what\nother specialists charge or consider being treated as a public patient at a\npublic hospital.\n\nYou should contact your health insurer to ask about benefits for your\nhospitalisation and your medical bills.\n\n ### Hospital charges for private patients\n\nHospital charges you might have to pay as a private patient include:\n\n* accommodation\n* operating theatre fees\n* [prostheses](/topics/private-health-insurance/what-private-health-insurance-covers/prostheses-cover-under-private-health-insurance \"Prostheses cover under private health insurance\") costs, for example plates, screws, artificial joints\n* medicines and dressings\n* costs for physiotherapy and other therapies in hospital\n\nIf you have private hospital insurance the amount your insurer will pay for\nthese depends on:\n\n* your policy\n* whether your insurer has an agreement with the hospital\n\nSome policies pay only the Government mandated minimum amount for hospital\ncharges for all or some types of treatment. This could mean you pay high out\nof pocket costs.\n\n The MBS fee for the surgeon\u2019s services is $1,000. Medicare pays $750. Your\nhealth insurer pays $250. This leaves an $800 gap you have to pay.\n\nYou also needed an anaesthetist, assistant surgeon, radiology and pathology\ntests. You can work out your out of pocket costs for them the same way you\nworked out the surgeon\u2019s. For this example, assume their total fees were\n$3,500 and you must pay $600 out of pocket.\n\nYour hospital charges are $8,500. Your insurer pays most of this cost but\nthere is no Medicare benefit. You must pay an excess of $750.\n\nThe total costs of your treatment is $13,800. You pay $2,450, which is made up\nof:\n\n* $800 for your surgeon and $600 for other providers\n* your hospital charge excess of $750\n\n## Gap arrangements for hospital treatment\n\nDoctors set their own fees for private medical services.  Your benefit must be no less than 85% of the average charge for similar\ntreatment in another hospital of the same category.\n\nWe publish a list of all [Commonwealth-declared hospitals (Excel, 292\nKB)](https://www1.health.gov.au/internet/main/publishing.nsf/Content/765860CBE64ED1E4CA257BF0001915B4/$File/All%20Declared%20Hospitals%20\\(current%20as%20at%2010%20July%202020\\).xlsx).\n\nYou can use this list to check:\n\n* whether a hospital is second-tier default benefits eligible\n* its second-tier default benefits eligibility category\n\n### Work out your hospital admission costs\n\nAs a private patient your total out of pocket costs will be the sum of all\nhospital charges, doctors\u2019 fees and fees from other providers, minus any\nMedicare or private health insurance payments.\n\n**Example:**\n\nYou have private hospital insurance for an operation in a private hospital.\nYour policy has a $750 excess and no co-payment.\n\nYour surgeon charges $1,800. They do not have a gap cover arrangement with\nyour insurer.\n\nThe MBS fee for the surgeon\u2019s services is $1,000. Medicare pays $750. Your\nhealth insurer pays $250.  ### Medicare: Australia's public health system\n\nUnlike Australian citizens who can use the public health system\u00c2\n[Medicare](/health_insurance/what_is_covered/medicare.htm \"What is covered by\nMedicare?\")\u00c2 to cover their medical and hospital expenses, overseas visitors\nwho hold temporary visas are not generally eligible to use Medicare.\n\nThis means that if you need medical attention while you are visiting Australia\nyou could find yourself substantially out of pocket. Even in a public hospital\nyou could be charged\u00c2 more than\u00c2 $1,000 a day in hospital fees alone. Without\nhealth cover you can find yourself responsible for the full cost of treatment.\n\nIf you are unsure of your Medicare eligibility status, you should check with\nyour local Medicare office or contact the [Medicare (Services\nAustralia)](https://www.servicesaustralia.gov.au/individuals/contact-us \"Link\n- Services Australia - Contact Us\").\n\n The remaining hospital and medical costs will be charged to you - some or all\nof these costs may be covered by your private health insurance, depending on\nyour policy.\n\nThe remaining costs include\u00c2 25% of the MBS fee for doctors' services and any\namount the doctors charge above the MBS fee, plus some or all the costs of:\n\n* hospital accommodation;\n* theatre fees;\n* intensive care;\u00c2\n* drugs, dressings and other consumables;\n* prostheses (surgically implanted);\n* diagnostic tests;\n* pharmaceuticals; and\n* any additional doctor's fees.\n\n|\n\nAs a public patient you will be treated at no charge.\n\n It is equivalent to the amount a public hospital would\ncharge a private patient for a shared room, usually as an all inclusive daily\nrate of approximately $250-$300 depending on where you are in Australia.\n\nIf you are entitled to only the minimum benefit and are attending a private\nhospital, the extra charges you will need to pay yourself include the amount\nabove what the hospital charges for accommodation as well as theatre or labour\nward plus any fees for medical services and other items such as\npharmaceuticals that aren\u00e2\u0080\u0099t covered by your insurer (see [What is\ncovered?](/health_insurance/what_is_covered/index.htm \"What is covered?\")for\nfurther details).\n\nThe cost of theatre or labour ward in a private facility depends on the\ncomplexity of the procedure being performed and can range from a couple of\nhundred dollars to several thousand dollars.  Pharmacists have the option to discount the patient co-payment by up to a\nmaximum of $1.00, should they choose to do so.\n\n[Private health insurance](/topics/private-health-insurance \"Private health\ninsurance\") covers many services that Medicare doesn\u2019t cover \u2013 like ambulance\nservices, dental services, physiotherapy, glasses and lenses.\n\nThis system helps Australians access the health care they need, while keeping\nthe cost of Medicare sustainable for taxpayers.\n\nRead more about the [cost of Medicare to taxpayers](/node/40784#the-cost-of-\nmedicare-to-taxpayers).\n\n## **Hospital costs**\n\nIf you are a public patient in hospital, Medicare covers all your medical\nexpenses.\n\nIf you are a private patient in a public hospital, Medicare subsidises the\ndoctor fees paid by the patient. You pay for hospital accommodation, theatre\nfees and doctors\u2019 fees. If you have [private health\ninsurance](https://www.health.gov.au/health-topics/private-health-insurance),\nyou might get some of these costs back, depending on your policy.\n\n You pay $2,450, which is made up\nof:\n\n* $800 for your surgeon and $600 for other providers\n* your hospital charge excess of $750\n\n## Gap arrangements for hospital treatment\n\nDoctors set their own fees for private medical services. They can charge more\nthan the MBS fee set by the Australian Government.\n\nWhen a doctor\u2019s fee for hospital treatment is higher than the MBS fee, the\ndifference is called the gap. You pay the gap, or your private health insurer\nmight where there is a gap cover arrangement. It\u2019s normal for there to be out\nof pocket costs in many situations. However, many doctors and insurers use gap\narrangements to remove or reduce your gap payment.\n\n ## What out of pocket costs you might pay\n\nAny out of pocket costs you pay will vary depending on:\n\n* how much you are charged\n* whether you have treatment in hospital or outside hospital\n* whether your treatment is covered by Medicare and [how much Medicare pays](https://www.servicesaustralia.gov.au/individuals/subjects/whats-covered-medicare)\n* if you are treated at a hospital, whether you are a public or private patient\n* whether you have private cover for the treatment and if so, your level of cover\n\nDoctor\u2019s fees can only be covered by private health insurance for treatment in\nhospital. Different insurers might pay a different amount for the same\nservice. Talk to your doctor, hospital and health insurer about:\n\n* what your costs might be\n* when you must pay them\n\nSee our [practical tips for exploring the costs of medical treatment\noptions](/resources/publications/a-guide-to-out-of-pocket-medical-costs-\nhelping-you-plan-for-the-cost-of-medical-treatment \"A guide to out of pocket\nmedical costs \u2013 helping you plan for the cost of medical treatment\").\n\n\n===\n Q: If I break my leg and go to hospital, how much will it cost me? I am an Australian Citizen. I do not have any private health cover. I am going to a public hospital.\nA:\n\n===\n Answer the question using the above context as guidance. Do not quote the context. Think step by step."

attempts = [
    "Be as helpful as possible. Answer in the style of blinky bill, use lots of aussie slang",
    "Be as helpful as possible. Answer in the style of crocodile dundee, use lots of aussie slang."
]


for a in attempts:
    messages = [
        {'role': 'user', 'content': base_prompt + ' ' + a + '\n===\nA:'},
    ]

    print('sending message')

    response = openai.ChatCompletion.create(
        model="gpt-3.5-turbo",
        messages=messages,
        temperature=0.2,
        max_tokens=200
    )
    first_pass = response['choices'][0]['message']['content']

    print(first_pass)